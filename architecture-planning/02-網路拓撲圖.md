# ç¶²è·¯æ‹“æ’²èˆ‡é…ç½®

## ğŸ“Š å®Œæ•´ç¶²è·¯æ‹“æ’²åœ–

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        Internet
                           â”‚
                   å…¬ç¶² IP: X.X.X.X
                           â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    é‚Šç•Œé˜²ç«ç‰†
                 (å¯é¸: Cloudflare)
                           â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           â”‚
                           â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   VPN Gateway Server     â”‚
            â”‚  (WireGuard)             â”‚
            â”‚                          â”‚
            â”‚  å…¬ç¶²: X.X.X.X           â”‚
            â”‚  å…§ç¶²: 10.0.0.1          â”‚
            â”‚                          â”‚
            â”‚  âœ“ å”¯ä¸€å°å¤–é–‹æ”¾å…¥å£      â”‚
            â”‚  âœ“ èº«ä»½é©—è­‰              â”‚
            â”‚  âœ“ æµé‡åŠ å¯†              â”‚
            â”‚  âœ“ æ—¥èªŒè¨˜éŒ„              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ (å…§ç¶²äº¤æ›æ©Ÿ)
                    â”‚ 10.0.0.0/16
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚                       â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                  å…§éƒ¨æœå‹™ç¶²è·¯
                (æ‰€æœ‰æœå‹™åªå° VPN Gateway é–‹æ”¾)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚           â”‚                       â”‚
        â†“           â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitLab    â”‚ â”‚     Dev     â”‚   â”‚   Staging   â”‚
â”‚             â”‚ â”‚ Environment â”‚   â”‚ Environment â”‚
â”‚ 10.0.1.10   â”‚ â”‚  10.0.2.x   â”‚   â”‚  10.0.3.x   â”‚
â”‚             â”‚ â”‚             â”‚   â”‚             â”‚
â”‚ é–‹æ”¾ç«¯å£:    â”‚ â”‚ é–‹æ”¾ç«¯å£:    â”‚   â”‚ é–‹æ”¾ç«¯å£:    â”‚
â”‚ 80,443,22   â”‚ â”‚ 8080-8099   â”‚   â”‚ 8000-8020   â”‚
â”‚             â”‚ â”‚             â”‚   â”‚             â”‚
â”‚ ç™½åå–®:      â”‚ â”‚ ç™½åå–®:      â”‚   â”‚ ç™½åå–®:      â”‚
â”‚ 10.0.0.1    â”‚ â”‚ 10.0.0.1    â”‚   â”‚ 10.0.0.1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â†“           â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Docs     â”‚ â”‚ Monitoring  â”‚   â”‚  Database   â”‚
â”‚             â”‚ â”‚             â”‚   â”‚             â”‚
â”‚ 10.0.4.10   â”‚ â”‚  10.0.5.x   â”‚   â”‚  10.0.6.x   â”‚
â”‚             â”‚ â”‚             â”‚   â”‚             â”‚
â”‚ é–‹æ”¾ç«¯å£:    â”‚ â”‚ é–‹æ”¾ç«¯å£:    â”‚   â”‚ é–‹æ”¾ç«¯å£:    â”‚
â”‚ 80,443      â”‚ â”‚ 3000,9090   â”‚   â”‚ 5432        â”‚
â”‚             â”‚ â”‚             â”‚   â”‚             â”‚
â”‚ ç™½åå–®:      â”‚ â”‚ ç™½åå–®:      â”‚   â”‚ ç™½åå–®:      â”‚
â”‚ 10.0.0.1    â”‚ â”‚ 10.0.0.1    â”‚   â”‚ 10.0.0.1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ç›£æ§æ•¸æ“šæµ
            (å–®å‘æ”¶é›†ï¼Œä¸å½±éŸ¿æ¥­å‹™)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ELK + Prometheus        â”‚
            â”‚  (æ—¥èªŒ + æŒ‡æ¨™æ”¶é›†)        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ IP åœ°å€è¦åŠƒ

### ç¶²æ®µåˆ†é…è¡¨

| ç¶²æ®µ | ç”¨é€” | IP ç¯„åœ | èªªæ˜ |
|------|------|---------|------|
| `10.0.0.0/24` | VPN å®¢æˆ¶ç«¯ | 10.0.0.1 - 10.0.0.254 | VPN Gateway + é€£ç·šå“¡å·¥ |
| `10.0.1.0/24` | æ ¸å¿ƒæœå‹™ | 10.0.1.1 - 10.0.1.254 | GitLab, CI/CD Runner |
| `10.0.2.0/24` | é–‹ç™¼ç’°å¢ƒ | 10.0.2.1 - 10.0.2.254 | Dev Servers |
| `10.0.3.0/24` | æ¸¬è©¦ç’°å¢ƒ | 10.0.3.1 - 10.0.3.254 | Staging Servers |
| `10.0.4.0/24` | æ–‡æª”æœå‹™ | 10.0.4.1 - 10.0.4.254 | Wiki, Confluence |
| `10.0.5.0/24` | ç›£æ§æœå‹™ | 10.0.5.1 - 10.0.5.254 | Grafana, Prometheus |
| `10.0.6.0/24` | è³‡æ–™åº« | 10.0.6.1 - 10.0.6.254 | PostgreSQL, Redis |

### å›ºå®š IP åˆ†é…

```yaml
# VPN Gateway
10.0.0.1: VPN Gateway Server

# æ ¸å¿ƒæœå‹™
10.0.1.10: GitLab Server
10.0.1.20: GitLab Runner 1
10.0.1.21: GitLab Runner 2

# é–‹ç™¼ç’°å¢ƒ
10.0.2.10: Dev Backend Server
10.0.2.20: Dev Frontend Server
10.0.2.30: Dev Database

# æ¸¬è©¦ç’°å¢ƒ
10.0.3.10: Staging Backend
10.0.3.20: Staging Frontend
10.0.3.30: Staging Database

# æ–‡æª”æœå‹™
10.0.4.10: Documentation Server

# ç›£æ§æœå‹™
10.0.5.10: Grafana
10.0.5.20: Prometheus
10.0.5.30: Elasticsearch
10.0.5.40: Kibana

# è³‡æ–™åº«
10.0.6.10: PostgreSQL Master
10.0.6.11: PostgreSQL Replica
10.0.6.20: Redis Master
10.0.6.30: MinIO (Object Storage)
```

### VPN å®¢æˆ¶ç«¯ IP åˆ†é…ç­–ç•¥

```yaml
# ç®¡ç†å±¤
10.0.0.10-19: CTO, æŠ€è¡“ä¸»ç®¡

# è³‡æ·±å·¥ç¨‹å¸«
10.0.0.20-49: Senior Developers

# ä¸€èˆ¬å·¥ç¨‹å¸«
10.0.0.50-99: Developers

# QA åœ˜éšŠ
10.0.0.100-119: QA Engineers

# å¤–åŒ…/è‡¨æ™‚äººå“¡
10.0.0.200-249: Contractors
```

---

## ğŸ”Œ ç«¯å£æ˜ å°„è¡¨

### VPN Gateway ç›£è½ç«¯å£

| ç«¯å£ | å”è­° | ç”¨é€” | å°å¤–é–‹æ”¾ |
|------|------|------|----------|
| 51820 | UDP | WireGuard VPN | âœ… æ˜¯ |
| 22 | TCP | SSH ç®¡ç† | âš ï¸ åƒ…ç‰¹å®šIP |

### å…§éƒ¨æœå‹™ç«¯å£

**GitLab (10.0.1.10)**
| ç«¯å£ | ç”¨é€” | å…è¨±ä¾†æº |
|------|------|----------|
| 80 | HTTP | 10.0.0.0/16 |
| 443 | HTTPS | 10.0.0.0/16 |
| 22 | Git SSH | 10.0.0.0/16 |

**é–‹ç™¼ç’°å¢ƒ (10.0.2.x)**
| ç«¯å£ | ç”¨é€” | å…è¨±ä¾†æº |
|------|------|----------|
| 8080 | Backend API | 10.0.0.0/16 |
| 3000 | Frontend | 10.0.0.0/16 |
| 5432 | PostgreSQL | 10.0.2.0/24 |

**æ¸¬è©¦ç’°å¢ƒ (10.0.3.x)**
| ç«¯å£ | ç”¨é€” | å…è¨±ä¾†æº |
|------|------|----------|
| 8000 | Backend API | 10.0.0.0/16 |
| 3001 | Frontend | 10.0.0.0/16 |
| 5432 | PostgreSQL | 10.0.3.0/24 |

**ç›£æ§ç³»çµ± (10.0.5.x)**
| ç«¯å£ | ç”¨é€” | å…è¨±ä¾†æº |
|------|------|----------|
| 3000 | Grafana | 10.0.0.0/16 |
| 9090 | Prometheus | 10.0.5.0/24 |
| 5601 | Kibana | 10.0.0.0/16 |
| 9200 | Elasticsearch | 10.0.5.0/24 |

---

## ğŸš¦ æµé‡è·¯å¾‘è©³è§£

### å ´æ™¯ 1: å“¡å·¥å­˜å– GitLab

```
1. å“¡å·¥é€£æ¥ VPN
   å“¡å·¥é›»è…¦ (192.168.1.x) 
        â†“
   WireGuard Client
        â†“ (é€é Internet, åŠ å¯†)
   VPN Gateway (å…¬ç¶² IP)
        â†“
   é©—è­‰é€šéï¼Œåˆ†é… IP: 10.0.0.25

2. å“¡å·¥è¨ªå• GitLab
   ç€è¦½å™¨: https://gitlab.company.internal
        â†“ (DNS è§£æ)
   10.0.1.10
        â†“ (é€é VPN éš§é“)
   VPN Gateway (10.0.0.1)
        â†“ (æª¢æŸ¥æ¬Šé™)
   è½‰ç™¼åˆ° GitLab (10.0.1.10:443)
        â†“
   GitLab è™•ç†è«‹æ±‚
        â†“
   å›æ‡‰ â†’ VPN Gateway â†’ å“¡å·¥

ç›£æ§è¨˜éŒ„:
- ä¾†æº: 10.0.0.25 (å“¡å·¥ A)
- ç›®æ¨™: 10.0.1.10:443 (GitLab)
- æ™‚é–“: 2025-12-18 10:30:15
- å‹•ä½œ: HTTPS GET /
- çµæœ: 200 OK
```

### å ´æ™¯ 2: å…§éƒ¨æœå‹™äº’é€£

```
Dev Server é€£æ¥ Database

1. æ‡‰ç”¨ç¨‹å¼ç™¼èµ·è«‹æ±‚
   Dev Backend (10.0.2.10)
        â†“
   ç›®æ¨™: PostgreSQL (10.0.2.30:5432)
        â†“ (å…§ç¶²ç›´é€£)
   Database Server (10.0.2.30)

2. ä¸ç¶“é VPN Gateway
   å…§ç¶²æµé‡ç›´æ¥é€šè¨Š
   ä½†ä»è¢«ç›£æ§ç³»çµ±è¨˜éŒ„

ç›£æ§è¨˜éŒ„:
- ä¾†æº: 10.0.2.10 (Dev Backend)
- ç›®æ¨™: 10.0.2.30:5432 (Database)
- æ™‚é–“: 2025-12-18 10:30:20
- å‹•ä½œ: SQL Query
```

### å ´æ™¯ 3: æœå‹™å°å¤–æ›´æ–°

```
GitLab æ›´æ–°å¥—ä»¶

1. GitLab ç™¼èµ·æ›´æ–°
   GitLab (10.0.1.10)
        â†“
   ç›®æ¨™: apt.ubuntu.com
        â†“ (å…§ç¶²ç¶²é—œ)
   VPN Gateway (10.0.0.1)
        â†“ (NAT è½‰æ›)
   Internet

2. NAT è¦å‰‡
   å…§ç¶² IP â†’ å…¬ç¶² IP
   å…è¨±å…§éƒ¨æœå‹™è¨ªå•å¤–ç¶²
   ä½†å¤–ç¶²ç„¡æ³•ä¸»å‹•é€£å…¥

ç›£æ§è¨˜éŒ„:
- ä¾†æº: 10.0.1.10 (GitLab)
- ç›®æ¨™: apt.ubuntu.com
- å‹•ä½œ: Package Update
```

---

## ğŸ” é˜²ç«ç‰†è¦å‰‡è©³ç´°é…ç½®

### VPN Gateway é˜²ç«ç‰†

**INPUT è¦å‰‡ï¼ˆå…¥ç«™ï¼‰**
```bash
# å…è¨± VPN é€£ç·š
ACCEPT UDP 51820 from 0.0.0.0/0

# å…è¨± SSHï¼ˆåƒ…ç®¡ç† IPï¼‰
ACCEPT TCP 22 from <ç®¡ç†IP>

# å…è¨±å…§ç¶²å›å‚³æµé‡
ACCEPT from 10.0.0.0/16

# å…è¨±å·²å»ºç«‹çš„é€£ç·š
ACCEPT ESTABLISHED,RELATED

# æ‹’çµ•å…¶ä»–æ‰€æœ‰
DROP all
```

**FORWARD è¦å‰‡ï¼ˆè½‰ç™¼ï¼‰**
```bash
# å…è¨± VPN å®¢æˆ¶ç«¯ â†’ å…§ç¶²æœå‹™
ACCEPT from 10.0.0.0/24 to 10.0.0.0/16

# å…è¨±å…§ç¶²æœå‹™ â†’ å¤–ç¶²ï¼ˆæ›´æ–°ç”¨ï¼‰
ACCEPT from 10.0.0.0/16 to 0.0.0.0/0

# ä¸å…è¨±å¤–ç¶² â†’ å…§ç¶²ï¼ˆç›´æ¥é€£ç·šï¼‰
DROP from 0.0.0.0/0 to 10.0.0.0/16

# å…è¨±å…§ç¶²æœå‹™é–“é€šè¨Š
ACCEPT from 10.0.0.0/16 to 10.0.0.0/16
```

### å…§éƒ¨æœå‹™é˜²ç«ç‰†ï¼ˆä»¥ GitLab ç‚ºä¾‹ï¼‰

**INPUT è¦å‰‡**
```bash
# åƒ…å…è¨±ä¾†è‡ª VPN Gateway çš„æµé‡
ACCEPT from 10.0.0.1 to 10.0.1.10 port 80,443,22

# å…è¨±å…§ç¶²å…¶ä»–æœå‹™ï¼ˆå¦‚ç›£æ§ï¼‰
ACCEPT from 10.0.5.0/24 to 10.0.1.10

# å…è¨±å›å‚³æµé‡
ACCEPT ESTABLISHED,RELATED

# æ‹’çµ•å…¶ä»–æ‰€æœ‰ï¼ˆåŒ…æ‹¬å…¶ä»–å…§ç¶²ï¼‰
DROP all
```

---

## ğŸ“¡ DNS é…ç½®

### å…§éƒ¨ DNS è¦åŠƒ

```
# VPN Gateway æä¾› DNS æœå‹™

å…§éƒ¨åŸŸå: *.company.internal

gitlab.company.internal      â†’ 10.0.1.10
dev.company.internal         â†’ 10.0.2.10
staging.company.internal     â†’ 10.0.3.10
docs.company.internal        â†’ 10.0.4.10
grafana.company.internal     â†’ 10.0.5.10
kibana.company.internal      â†’ 10.0.5.40
```

### DNS è½‰ç™¼è¦å‰‡

```bash
# å…§éƒ¨åŸŸå
*.company.internal â†’ æŸ¥è©¢å…§éƒ¨ DNS

# å¤–éƒ¨åŸŸå
å…¶ä»– â†’ è½‰ç™¼åˆ° 8.8.8.8 (Google DNS)
```

---

## ğŸ”„ é«˜å¯ç”¨æ€§è¨­è¨ˆï¼ˆæœªä¾†æ“´å±•ï¼‰

### VPN Gateway é«˜å¯ç”¨æ¶æ§‹

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Keepalived â”‚ (è™›æ“¬ IP: 10.0.0.1)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†™    â†˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Gateway1 â”‚  â”‚ Gateway2 â”‚
    â”‚ (Master) â”‚  â”‚ (Backup) â”‚
    â”‚10.0.0.10 â”‚  â”‚10.0.0.11 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“             â†“
    [å…§éƒ¨æœå‹™ç¶²è·¯]
```

**ç‰¹æ€§**ï¼š
- ä¸»æ©Ÿæ•…éšœè‡ªå‹•åˆ‡æ›
- è™›æ“¬ IP æ¼‚ç§»
- é…ç½®åŒæ­¥
- å¥åº·æª¢æŸ¥

---

## ğŸ“Š ç¶²è·¯æ•ˆèƒ½è¦åŠƒ

### é »å¯¬éœ€æ±‚ä¼°ç®—

```
å°å‹åœ˜éšŠ (10äºº):
- VPN Gateway: 100 Mbps
- å…§ç¶²: 1 Gbps

ä¸­å‹åœ˜éšŠ (30äºº):
- VPN Gateway: 500 Mbps
- å…§ç¶²: 1 Gbps

å¤§å‹åœ˜éšŠ (50+äºº):
- VPN Gateway: 1 Gbps
- å…§ç¶²: 10 Gbps
```

### å»¶é²å„ªåŒ–

```
ç›®æ¨™:
- VPN é€£ç·šå»¶é²: < 50ms
- å…§ç¶²æœå‹™å»¶é²: < 10ms
- è³‡æ–™åº«æŸ¥è©¢: < 5ms

å»ºè­°:
- VPN Gateway èˆ‡æœå‹™å™¨åŒæ©Ÿæˆ¿
- ä½¿ç”¨ SSD å„²å­˜
- å……è¶³çš„ RAM
```

---

## ğŸ”— ç›¸é—œé…ç½®æª”æ¡ˆ

å¯¦éš›é…ç½®æª”æ¡ˆåƒè€ƒï¼š
- `configs/vpn-gateway/` - VPN Gateway é…ç½®
- `configs/firewall/` - é˜²ç«ç‰†è¦å‰‡
- `configs/dns/` - DNS é…ç½®
- `configs/monitoring/` - ç›£æ§é…ç½®
