# 安全策略與權限管理

## 🎯 安全設計原則

### 零信任原則 (Zero Trust)
> 不信任任何連線，每次存取都需驗證

```
原則：永不信任，始終驗證
- ✅ 每次連線都驗證身份
- ✅ 最小權限原則
- ✅ 持續監控行為
- ✅ 異常立即阻斷
```

### 深度防禦 (Defense in Depth)
> 多層防護，單點失效不影響整體安全

```
第1層: VPN 身份驗證
第2層: 防火牆過濾
第3層: 應用層權限
第4層: 審計與監控
第5層: 異常行為偵測
```

---

## 🔐 身份驗證與授權

### VPN 存取控制

**驗證方式：公私鑰配對**

```
員工入職:
1. 生成個人金鑰對
   - 私鑰: 員工保管（絕不上傳）
   - 公鑰: 加入 VPN Gateway

2. 分配內網 IP
   - 根據角色分配不同網段
   - 自動記錄到員工檔案

3. 配置存取權限
   - 可存取的服務清單
   - 可使用的端口
   - 時間限制（可選）

員工離職:
1. 立即從 VPN Gateway 移除公鑰
2. 所有存取權限自動失效
3. 無法再建立 VPN 連線
```

### 權限矩陣

| 角色 | GitLab | Dev | Staging | Production | Database | Monitoring |
|------|--------|-----|---------|------------|----------|------------|
| **CTO** | Owner | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Tech Lead** | Maintainer | ✅ | ✅ | 唯讀 | 唯讀 | ✅ |
| **Senior Dev** | Developer | ✅ | ✅ | ❌ | ❌ | 唯讀 |
| **Junior Dev** | Developer | ✅ | ✅ | ❌ | ❌ | ❌ |
| **QA** | Reporter | 唯讀 | ✅ | 唯讀 | ❌ | 唯讀 |
| **外包** | Guest | 特定專案 | ❌ | ❌ | ❌ | ❌ |

**權限說明**：
- ✅ 完整存取
- 唯讀：可查看不可修改
- ❌ 完全無權限
- 特定專案：僅特定 repo

---

## 🚨 威脅防護策略

### 外部威脅

**DDoS 攻擊防護**
```
第1層: Cloudflare (可選)
- 分散式 DDoS 防護
- CDN 加速

第2層: VPN Gateway 速率限制
- 單 IP 連線頻率限制
- 異常流量自動封鎖
- 黑名單機制

措施:
- 最大連線數限制
- 新連線速率限制
- 異常 IP 自動封鎖 1 小時
```

**暴力破解防護**
```
VPN 驗證機制:
- 使用公私鑰，無密碼
- 金鑰錯誤無法連線
- 無法暴力嘗試

額外保護:
- Fail2Ban 監控
- 3次失敗嘗試 → 封鎖 IP 24小時
- 記錄所有失敗嘗試
```

**漏洞掃描**
```
定期掃描:
- 每週自動掃描所有對外服務
- 使用 OpenVAS 或 Nessus
- 高危漏洞 24小時內修補

軟體更新策略:
- 安全更新: 立即套用
- 功能更新: 測試環境驗證後套用
- 每月定期更新所有系統
```

### 內部威脅

**異常行為偵測**
```
監控項目:
1. 時間異常
   - 非工作時間登入（< 6:00 或 > 23:00）
   - 假日大量操作

2. 行為異常
   - 大量下載程式碼（> 1GB）
   - 存取不相關的服務
   - 頻繁的權限變更請求

3. 地理位置異常
   - IP 地址突然變更國家
   - 同時多地登入

4. 操作異常
   - 批量刪除程式碼
   - 修改關鍵配置
   - 存取資料庫敏感資料

自動回應:
- 立即告警通知 CTO
- 可選: 自動暫停 VPN 存取
- 建立事件單供調查
```

**資料外洩防護**
```
預防措施:
1. 網路層
   - 大量下載觸發告警
   - 限制單次下載量

2. 應用層
   - GitLab 防止 force push
   - 敏感檔案水印（可選）

3. 監控層
   - 記錄所有 git clone/pull
   - 追蹤檔案存取記錄
   - 異常模式識別

應變計畫:
- 發現洩漏 → 立即撤銷權限
- 通知法務 / 安全團隊
- 調查根本原因
- 評估影響範圍
```

**離職員工處理**
```
離職前:
- 交接工作清單
- 移除關鍵權限
- 保留唯讀權限（如需要）

離職當日:
1. 立即撤銷 VPN 存取
2. 停用 GitLab 帳號
3. 撤銷所有第三方服務權限
4. 收回筆電/門禁卡

離職後:
- 30天後完全刪除帳號
- 保留操作記錄至少1年
- 定期審查遺留權限
```

---

## 📝 稽核與合規

### 稽核記錄項目

**VPN 層級**
```yaml
記錄內容:
- user: 使用者名稱
- timestamp: 連線時間
- client_ip: 客戶端公網 IP
- vpn_ip: 分配的內網 IP
- duration: 連線時長
- data_transfer: 傳輸資料量
- disconnect_reason: 斷線原因

保留期限: 1年
儲存位置: 加密儲存
存取權限: CTO, 稽核人員
```

**應用層級**
```yaml
記錄內容:
- user: 使用者
- timestamp: 操作時間
- service: 存取的服務
- action: 執行的動作
- resource: 存取的資源
- result: 成功/失敗
- changes: 變更內容（如適用）

保留期限: 2年
儲存位置: ELK Stack
存取權限: CTO, Tech Lead, 稽核人員
```

**資料庫層級**
```yaml
記錄內容:
- user: 資料庫使用者
- timestamp: 查詢時間
- query_type: SELECT/INSERT/UPDATE/DELETE
- affected_tables: 影響的資料表
- rows_affected: 影響的資料筆數

保留期限: 3年
儲存位置: 獨立稽核資料庫
存取權限: CTO, DBA, 稽核人員
```

### 定期審查

**每日審查（自動）**
```
- 失敗登入嘗試
- 異常時間存取
- 高權限操作
- 告警事件

輸出: 每日安全報告
接收人: CTO, Tech Lead
```

**每週審查（人工）**
```
- 新增/移除的使用者
- 權限變更記錄
- 異常行為總結
- 系統漏洞狀態

輸出: 每週安全會議
參與人: 技術團隊
```

**每月審查（深度）**
```
- 完整權限檢查
- 未使用帳號清理
- 安全政策更新
- 事件追蹤回顧

輸出: 每月安全報告
提交給: 管理層
```

**每季審查（全面）**
```
- 第三方安全評估
- 滲透測試
- 災難恢復演練
- 合規檢查

輸出: 季度安全評估報告
提交給: 董事會
```

---

## 🔒 資料加密策略

### 傳輸加密

```
VPN 層:
- 協議: WireGuard
- 加密: ChaCha20-Poly1305
- 金鑰交換: Curve25519
- 強度: 軍事級

應用層:
- 協議: HTTPS (TLS 1.3)
- 憑證: Let's Encrypt
- 密碼套件: 現代化配置
- HSTS: 啟用
```

### 靜態加密

```
檔案儲存:
- 磁碟加密: LUKS (Linux)
- 金鑰管理: 集中管理
- 備份加密: 是

資料庫:
- 透明資料加密 (TDE)
- 敏感欄位額外加密
- 備份加密

程式碼倉庫:
- Git 倉庫加密（可選）
- 敏感配置使用 Secret 管理
- 憑證不入庫
```

### 金鑰管理

```
生命週期:
- 生成: 安全隨機數生成器
- 儲存: 加密儲存
- 輪替: 每季度
- 撤銷: 立即生效
- 銷毀: 安全刪除

存取控制:
- 金鑰存取需雙人授權
- 所有存取記錄
- 定期審核
```

---

## 📋 安全檢查清單

### 每日檢查
- [ ] 查看安全告警
- [ ] 檢查失敗登入
- [ ] 確認備份完成
- [ ] 監控異常流量

### 每週檢查
- [ ] 審查新增使用者
- [ ] 檢查權限變更
- [ ] 更新安全補丁
- [ ] 測試告警系統

### 每月檢查
- [ ] 完整權限審查
- [ ] 清理未使用帳號
- [ ] 更新安全政策
- [ ] 災難恢復測試

### 每季檢查
- [ ] 外部安全評估
- [ ] 滲透測試
- [ ] 金鑰輪替
- [ ] 合規性審查

---

## 🚨 事件應變計畫

### 安全事件分級

```
P0 - 緊急 (立即處理)
- 資料外洩
- 系統被入侵
- 勒索軟體攻擊
- DDoS 導致服務中斷

P1 - 高優先級 (2小時內)
- 異常登入成功
- 大量資料下載
- 權限提升嘗試
- 關鍵漏洞發現

P2 - 中優先級 (24小時內)
- 多次登入失敗
- 可疑行為偵測
- 一般漏洞發現
- 政策違規

P3 - 低優先級 (1週內)
- 軟體版本過舊
- 配置不當
- 文檔缺失
```

### 應變流程

```
1. 偵測
   - 自動監控系統告警
   - 人工發現回報
   ↓

2. 評估
   - 確認事件真實性
   - 評估影響範圍
   - 判定嚴重等級
   ↓

3. 遏制
   - P0: 立即隔離受影響系統
   - 暫停可疑帳號
   - 阻斷攻擊來源
   ↓

4. 根除
   - 清除惡意程式
   - 修補漏洞
   - 重置受影響憑證
   ↓

5. 恢復
   - 從備份恢復
   - 驗證系統完整性
   - 逐步恢復服務
   ↓

6. 事後檢討
   - 撰寫事件報告
   - 分析根本原因
   - 更新安全政策
   - 團隊培訓
```

### 緊急聯絡清單

```
第一層回應:
- CTO (Mike)
- Tech Lead
- 值班工程師

第二層回應:
- IT 安全顧問
- 法務顧問
- 公關團隊

外部資源:
- 資安公司
- 雲端服務商
- 執法機關
```

---

## 🎓 安全培訓

### 新進員工培訓

```
第1天: 安全意識
- 公司安全政策
- VPN 使用方法
- 密碼管理
- 社交工程防範

第1週: 實務操作
- GitLab 安全使用
- 程式碼安全規範
- 敏感資料處理
- 事件回報流程

定期複訓: 每季度
- 最新威脅趨勢
- 安全事件案例
- 政策更新
```

### 安全文化建設

```
激勵機制:
- 發現安全漏洞獎勵
- 安全意識分享會
- 安全競賽活動

懲罰機制:
- 第1次違規: 警告 + 培訓
- 第2次違規: 書面警告
- 第3次違規: 考慮解職

持續改進:
- 收集安全建議
- 定期政策review
- 分享業界最佳實踐
```

---

## 📚 參考標準

- ISO 27001 (資訊安全管理)
- NIST Cybersecurity Framework
- OWASP Top 10
- CIS Controls
- GDPR (如適用)
